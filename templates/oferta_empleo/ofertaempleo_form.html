{% extends 'base.html' %}
{% block title %}{% if object %}Editar Oferta{% else %}Publicar Nueva Oferta{% endif %}{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-4">
        <style>
          .form-control::placeholder { color: #9ca3af; opacity: 1; }
          textarea.form-control::placeholder { white-space: pre-line; }
        </style>
        <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
          <div>
            <h1 class="h4 mb-1">{% if object %}Editar Oferta: {{ object.titulo }}{% else %}Publicar Nueva Oferta{% endif %}</h1>
            <div class="text-muted">Completa los campos y usa las plantillas para acelerar.</div>
          </div>
          <div class="d-flex align-items-center gap-2">
            <span class="badge bg-primary">Paso 1: Datos</span>
            <span class="badge bg-secondary">Paso 2: Contenido</span>
            <span class="badge bg-secondary">Paso 3: Confirmación</span>
          </div>
        </div>
        {% if industry_examples %}
        <div class="mb-3 p-3 border rounded">
          <div class="d-flex flex-wrap gap-2 mb-0">
            {% for ex in industry_examples %}
              <button type="button" class="btn btn-outline-secondary btn-sm" data-title="{{ ex.title }}" data-desc="{{ ex.desc }}">{{ ex.title }}</button>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        <form method="post" class="row g-3">
          {% csrf_token %}
          <div class="col-md-6">
            <label class="form-label">{{ form.region.label }}</label>
            {{ form.region }}
            {% if form.region.errors %}<div class="text-danger small mt-1">{{ form.region.errors }}</div>{% endif %}
          </div>
          <div class="col-md-6">
            <label class="form-label">{{ form.tipo_contrato.label }}</label>
            {{ form.tipo_contrato }}
            {% if form.tipo_contrato.errors %}<div class="text-danger small mt-1">{{ form.tipo_contrato.errors }}</div>{% endif %}
          </div>
          <div class="col-12">
            <label class="form-label">{{ form.titulo.label }}</label>
            {{ form.titulo }}
            <div class="text-muted small mt-1">Usa un título claro indicando rol y tecnologías.</div>
            {% if form.titulo.errors %}<div class="text-danger small mt-1">{{ form.titulo.errors }}</div>{% endif %}
          </div>
          <div class="col-12">
            <label class="form-label">{{ form.descripcion.label }}</label>
            {{ form.descripcion }}
            <div class="d-flex justify-content-between"><div class="text-muted small mt-1">Puedes partir con una plantilla y ajustar.</div><div class="small" id="desc-count"></div></div>
            {% if form.descripcion.errors %}<div class="text-danger small mt-1">{{ form.descripcion.errors }}</div>{% endif %}
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">{{ form.estado.label }}</label>
            {{ form.estado }}
            {% if form.estado.errors %}<div class="text-danger small mt-1">{{ form.estado.errors }}</div>{% endif %}
          </div>
          <div class="col-12 d-flex gap-2 mt-2">
            <button type="submit" class="btn btn-gradient">Guardar</button>
            <a href="{% if object %}{% url 'ofertaempleo-detail' object.pk %}{% else %}{% url 'ofertaempleo-list' %}?empresa_id={{ request.user.pk }}{% endif %}" class="btn btn-outline-secondary">Cancelar</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
  const buttons = document.querySelectorAll('button[data-title]');
  const tituloInput = document.querySelector('[name="titulo"]');
  const descInput = document.querySelector('[name="descripcion"]');
  buttons.forEach(b => {
    b.addEventListener('click', () => {
      if (tituloInput) tituloInput.value = b.getAttribute('data-title');
      if (descInput) descInput.value = b.getAttribute('data-desc');
      updateCount();
    });
  });
  function updateCount(){
    const el = document.getElementById('desc-count');
    if (!el || !descInput) return;
    const len = (descInput.value || '').length;
    el.textContent = len + ' caracteres';
  }
  if (descInput) {
    descInput.addEventListener('input', updateCount);
    updateCount();
  }
</script>
{% endblock %}
